<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TRPG テキストセッションのログを変換するやつ</title>
<meta property="og:title" content="TRPG テキストセッションのログを変換するやつ" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://shunshun94.github.io/shared/jquery/io/github/shunshun94/trpg/logEditor/resources/converter_ogp.png" />
<meta property="og:site_name" content="https://github.com/Shunshun94/shared/" />
<meta property="og:description" content="ココフォリア、ユドナリウム、Tekey、Flocon、どどんとふむせる、LINE のテキストログを変換するツール" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@Shunshun94" />
<meta name="twitter:domain" content="shunshun94.github.io" />
<meta name="twitter:image" content="https://shunshun94.github.io/shared/jquery/io/github/shunshun94/trpg/logEditor/resources/converter_ogp.png" />
<meta name="twitter:title" content="TRPG テキストセッションのログを変換するやつ" />
<meta name="twitter:description" content="ココフォリア、ユドナリウム、Tekey、Flocon、どどんとふむせる、LINE のテキストログを変換するツール" />
<link rel="stylesheet" href="css/logEditor.css" type="text/css" />
<link rel="stylesheet" href="css/darkmode.css" type="text/css" />
<link rel="stylesheet" href="css/experimentalMode.css" type="text/css" />
<style>
	#switch-darkmode:after {
		content: '出力の背景色を黒に変える';
	}
	.darkmode #switch-darkmode:after {
		content: '出力の背景色を白に変える';
	}
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
<button id="switch-darkmode" style="z-index:2;position:absolute;top:8px;right:8px;"></button>
<script>
var io = io || {};
io.github = io.github || {};
io.github.shunshun94 = io.github.shunshun94 || {};
io.github.shunshun94.trpg = io.github.shunshun94.trpg || {};
io.github.shunshun94.trpg.logEditor = io.github.shunshun94.trpg.logEditor || {};
io.github.shunshun94.trpg.logEditor.DOMS = {
	BODY: $('body')
};
io.github.shunshun94.trpg.logEditor.EVENTS = {
	FILE_LOADED: 'io-github-shunshun94-trpg-logEditor-file-loaded',
	FILE_DROPED: 'io-github-shunshun94-trpg-logEditor-file-droped'
};
</script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.2.1/dist/jszip.js"></script>
<script src="../../../../../../other/io/github/shunshun94/util/colorutil.js"></script>
<script src="./consts.js"></script>
<script src="./convertors/ccfoliaConvertor.js"></script>
<script src="./convertors/udonariumConvertor.js"></script>
<script src="./convertors/rawTextConvertor.js"></script>
<script src="./convertors/ytchatConvertor.js"></script>
<script src="./convertors/floconConvertor.js"></script>
<script src="./convertors/tekeyConvertor.js"></script>
<script src="./convertors/museruConvertor.js"></script>
<script src="./convertors/convertorFactory.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/1.0.30/encoding.min.js"></script>
<script src="../../../../../../external/jsSHA/sha256.js"></script>
<script src="exporter/htmlExporter.js"></script>
<script src="./InitialAppendInfo/link.js"></script>
<script src="./FileLoader/fileLoad.js"></script>
<script src="./FileLoader/tabFilter.js"></script>
<script>
const darkmode = 'darkmode';
const getBehaviorByMode = (mode) => {
	if(mode === darkmode) {
		return {
			defaultColor: 'white',
			modifyColor: (color)=>{
				if(color.l < 70) {
					color.l = 70;
					return color;
				} else {
					return color;
				}
			}
		};
	} else {
		return {
			defaultColor: 'black',
			modifyColor: (color)=>{
				if(color.l > 30) {
					color.l = 30;
					return color;
				} else {
					return color;
				}
			}
		};
	}
};

const modifyColors = (doms, mode) => {
	const colorMap = {};
	const behavior = getBehaviorByMode(mode);
	const getModifiedColor = (baseColor) => {
		if(colorMap[baseColor]) {return colorMap[baseColor];}
		const rgbColor = io.github.shunshun94.util.Color.colorConvert(baseColor);
		const hslColor = io.github.shunshun94.util.Color.RgbToHsl(rgbColor.r, rgbColor.g, rgbColor.b);
		const modifiedColorObject = behavior.modifyColor(hslColor);
		colorMap[baseColor] = `hsl(${Math.floor(modifiedColorObject.h)}, ${Math.floor(modifiedColorObject.s)}%, ${Math.floor(modifiedColorObject.l)}%)`;
		console.log(colorMap, rgbColor, hslColor, modifiedColorObject);
		return colorMap[baseColor];
	};
	return doms.map((post)=>{
		const execResult = /color:\s*([^;]*);?/.exec(post.style);
		const currentColor = execResult ? execResult[1] : behavior.defaultColor;
		const modifiedColor = getModifiedColor(currentColor);
		const replaceTarget = execResult ? execResult[0] : '';
		if(replaceTarget) {
			post.style = post.style.replace(replaceTarget, `color: ${modifiedColor};`);
		} else {
			post.style = `color: ${modifiedColor};${post.style}`;
		}
		return post;
	});
};
io.github.shunshun94.trpg.logEditor.DOMS.BODY.on(io.github.shunshun94.trpg.logEditor.EVENTS.FILE_LOADED, (e, domList)=>{
	io.github.shunshun94.trpg.logEditor.FileLoader.filtTabs(domList).then((filteredDomList)=>{
		const appendClass = ((io.github.shunshun94.trpg.logEditor.DOMS.BODY.attr('class') || '').match(/[a-z0-9A-Z]+mode/) || [''])[0];
		domList.doms = modifyColors(domList.doms, appendClass);
		io.github.shunshun94.trpg.logEditor.export.htmlExporter.download(io.github.shunshun94.trpg.logEditor.export.htmlExporter.domListToHtml(filteredDomList, appendClass));
		io.github.shunshun94.trpg.logEditor.FileLoader.bindInitialEvents(io.github.shunshun94.trpg.logEditor.DOMS.BODY);
	});
});

$('#switch-darkmode').click((e)=>{
	io.github.shunshun94.trpg.logEditor.DOMS.BODY.toggleClass(darkmode);
});
</script>
</body>
</html>