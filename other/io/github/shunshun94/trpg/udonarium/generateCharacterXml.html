<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ユドナリウムの駒を作るための XML を生成する</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="./generateCharacterXml.js"></script>
<script src="../discord/logPicker.js"></script>
</head>
<body>
URL: <input id="url" type="text" value="https://yutorize.2-d.jp/ytsheet/sw2.5/?id=KFyZla" />
<button id="executeAsCharacter">PCについて生成</button><button id="executeAsEnemy">魔物について生成</button>
<hr/>
<p id="download"></p>
<textarea style="width:600px;height:360px;" id="result"></textarea>
<script>
const exec = (mode) => {
	$.ajax({
		type:'get',
		url: `${$('#url').val()}&mode=json`,
		async:true,
		dataType:'jsonp'
	}).done((result)=>{
		if(mode === 'pc') {
			const data = io.github.shunshun94.trpg.udonarium.generateCharacterXmlFromYtSheet2SwordWorldPC(result, $('#url').val());
			$('#result').val(data);
			const url = io.github.shunshun94.trpg.discord.LogPicker.generateUrl(data, 'text/xml;charset=utf-8;');
			$('#download').html(`<a href="${url}" target="_blank" download="data_${result.characterName}.xml">ダウンロード</a>`);			
		}
		if(mode === 'enemy') {
			const data = io.github.shunshun94.trpg.udonarium.generateCharacterXmlFromYtSheet2SwordWorldEnemy(result, $('#url').val());
			$('#result').val(data);
			const url = io.github.shunshun94.trpg.discord.LogPicker.generateUrl(data, 'text/xml;charset=utf-8;');
			$('#download').html(`<a href="${url}" target="_blank" download="data_${result.monsterName}.xml">ダウンロード</a>`);			
		}
	});	
};


$('#executeAsCharacter').click((e)=>{exec('pc')});
$('#executeAsEnemy').click((e)=>{exec('enemy')});


</script>
</body>
</html>