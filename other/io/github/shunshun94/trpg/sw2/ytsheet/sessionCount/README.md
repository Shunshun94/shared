# ytsheet-session-count.js

## これは何？

ゆとシートのキャラクターシートの json を入れるとその PC がプレイヤーとして参加したセッションの回数を計算してくれるやつ。
オープンキャンペーンなどで利用されることを想定している。

## どうやって使うの？

[ytsheet-session-count.js](./ytsheet-session-count.js)の `io.github.shunshun94.trpg.sw2.ytsheet.countSession` を以下の引数を与えて呼び出す。

* 第一引数にキャラクターシートの json
* 第二引数（optional）に用いるコミュニティの名前

キャラクターシートの json については [公式のガイド](https://yutorize.2-d.jp/?ytsheet2-json)を参照すること。

## セッションであるか否かの基準

現時点では「ラクシアらいふ！ねお！」のルールに従って作成している。

### 「ラクシアらいふ！ねお！」のルールに従ったセッションである・ないの判定ロジック

以下7パターンについて考慮する。以下のような結果であることが望まれる。

| Case ID | Case1 | Case2 | Case3 | Case4 | Case5 | Case6 | Case7 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| GM回の卓である | Y | Y | Y | N | N | N | N |
| まだ経験点上限に達してない | Y | N | N | Y | N | N | - |
| 丁度経験点上限に達した卓 | N | Y | N | N | Y | N | - |
| 既に経験点上限に達している | N | N | Y | N | N | Y | - |
| そもそも関係ないメモ | N | N | N | N | N | N | Y |
|  |  |  |  |  |  |  |
| 経験点 | 規定額 | あり | なし | あり | あり | なし | 不安定 |
| ガメル | 規定額 | 規定額 | 規定額 | あり | あり | あり | 不安定 |
| GM欄 | 空欄または自身の名前 | 空欄または自身の名前 | 空欄または自身の名前 | GMの名前 | GMの名前 | GMの名前 | なし |
|  |  |  |  |  |  |  |
| プレイヤーとして参加したセッション扱い | N | N | N | Y | Y | Y | N |

よって、以下のいずれかに当てはまる場合は「セッションでは**ない**」として扱う。


1. GM欄が以下のいずれかである場合
    * 自分
    * 私
    * 空欄である
    * キャラクターシートに記載されたプレイヤーの名前を含む文字列である
    * キャラクターシートに記載されたプレイヤーが文字列を含んでいる
1. レギュレーションに定められた GM の報酬（経験点・ガメル）ど同額のものを受け取っている場合
1. 経験点とガメルの双方が空欄または0の場合

ただし、3については誤検知がありうる点には注意が必要。
経験点が上限に達しているかつ一切ガメルの収入がない卓があれば誤検知となる。

## 動作テスト

[こちら](./test.html)から確認。
