<!DOCTYPE html>
<html lang="ja">
<head
	　prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
<meta property="og:title" content="ゆとシート2からココフォリアの駒を作るツール for SW2.5" />
<meta property="og:type" content="website" />
<meta property="og:image"
	content="https://shunshun94.web.fc2.com/replies/terms/ogp.jpg" />
<meta property="og:site_name" content="https://shunshun94.web.fc2.com/" />
<meta property="og:description" content="ゆとシート2のソードワールド2.5のキャラクターシートからココフォリアの駒を作るツール" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@Shunshun94" />
<meta name="twitter:text:title" content="ゆとシートからココフォリアの駒を作るツール for SW2.5" />
<meta charset="UTF-8">
<title>ココフォリアの駒を作るための Json を生成する</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.2.1/dist/jszip.js"></script>
<script src="./ytsheetToCcfoliaSW25.js"></script>
<style>
footer {
	border-top:1px solid black;
	font-size:80%;
}
</style>
</head>
<body>
<h1>ゆとシート2からココフォリアの駒を作るツール for SW2.5</h1>

<div id="contents" style="padding:4px;">
<h2>PC データ</h2>
<p>URL: <input id="characterUrl" size="40" type="text" value="https://yutorize.2-d.jp/ytsheet/sw2.5/?id=wiORZs" />
<button id="executeAsCharacter">生成</button></p>
<p id="characterDownload">　</p>
<img id="characterPic" />

<h2>魔物データ</h2>
<p>URL: <input id="enemyUrl" size="40" type="text" value="https://yutorize.2-d.jp/ytsheet/sw2.5/?id=sw9uJA" />
　数： <input id="enemyCount" size="2" type="number" value="1" min="1" max="26" />
<button id="executeAsEnemy">生成</button></p>
<p id="enemyDownload">　</p>
</div>
<textarea style="width:600px;height:360px;display:none;" id="result"></textarea>

<h2>使い方</h2>
<ol>
	<li><a href="https://yutorize.2-d.jp/?ytsheet2">ゆとシート2</a>で作ったキャラクターシートの URL を URL 欄に入れる</li>
	<li>『生成』と書かれたボタンを押す</li>
	<li>ダウンロード data_(ランダムな文字列).zip と書かれたリンクが出てくるのでクリックして保存する</li>
	<li>保存されたファイルをココフォリアにドラッグ &amp; ドロップする</li>
</ol>
<footer>
	<p><a href="https://fujimi-trpg-online.jp/info/entry-2587.html">【ソード・ワールド】二次創作ガイドライン</a><br>本ツールは、「グループＳＮＥ」及び「株式会社ＫＡＤＯＫＡＷＡ」が権利を有する『ソード・ワールド2.5』のために作られたツールです。<br>(C)GroupSNE<br>(C)KADOKAWA</p>
</footer>
<script>
const linkToZip = (title, id, data)=>{
	const zip = new JSZip();
	zip.file(`__data.json`, data, {binary: false});
	zip.file(".token", `0.${io.github.shunshun94.trpg.ccfolia.generateRndStr()}`);
	zip.generateAsync({ type: "blob", compression: "DEFLATE", compressionOptions: {level: 9}}).then(blob => {
		const dataUrl = URL.createObjectURL(blob);
		$(`#${id}Download`).html(`<a href="${dataUrl}" target="_blank" download="data_${title}.zip">ダウンロード data_${title}.zip</a>`);
	});
};

const exec = (mode, id) => {
	const sheetUrl = $(`#${id}Url`).val();
	$.ajax({
		type:'get',
		url: `${sheetUrl}&mode=json`,
		async:true,
		dataType:'jsonp'
	}).done((result)=>{
		if(mode === 'pc') {
			const json = io.github.shunshun94.trpg.ccfolia.generateCharacterJsonFromYtSheet2SwordWorldPC(result, sheetUrl);
			linkToZip(result.id, id, json);
		}
		if(mode === 'enemy') {
			const count = Number($('#enemyCount').val());
			const json = io.github.shunshun94.trpg.ccfolia.generateCharacterJsonFromYtSheet2SwordWorldEnemies(count, result, sheetUrl);
			linkToZip(result.id, id, json);
		}
	});
};
$('#executeAsCharacter').click((e)=>{exec('pc', 'character')});
$('#executeAsEnemy').click((e)=>{exec('enemy', 'enemy')});


</script>
</body>
</html>